name: Prettier

on: [pull_request]

jobs:
  format:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js 12
      uses: actions/setup-node@v1
      with:
        node-version: 12
    - name: install yarn
      run: |
        curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.17.3
        export PATH=$HOME/.yarn/bin:$PATH
    - name: install dependencies and format
      run: |
        yarn
        yarn format
      env:
        CI: true
    - name: commit changes
      run: |
        git config --global user.name 'Haroenbot'
        git config --global user.email 'spam@haroen.me'
        # git config --global user.password $GITHUB_PUSH_TOKEN
        # git remote set-url origin https://haroenbot:$GITHUB_PUSH_TOKEN@github.com/haroenv/ci-prettier-test
        git checkout failing
        git add -A && git commit -m 'chore(prettier): format code [CI SKIP]' --allow-empty
        git push https://${GITHUB_PUSH_TOKEN}:x-oauth-basic@github.com/haroenv/ci-prettier-test HEAD
      env:
        GITHUB_PUSH_TOKEN: ${{ secrets.GITHUB_PUSH_TOKEN }}
